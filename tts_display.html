<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Chat Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: white;
            padding: 20px;
            text-align: center; /* Center align text in the body */
        }
        #image-container {
            margin-bottom: 10px; /* Space between image and messages */
        }
        #messages {
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            text-align: left; /* Left align messages */
        }
        .message {
            margin: auto;
            text-align: center;
            opacity: 1;
            transition: opacity 1s ease-out; /* Smooth transition for fading out */
        }
        .fade-out {
            opacity: 0; /* Fade out effect */
        }
        .wiggle {
            animation: wiggle 0.1s infinite alternate; /* Wiggle animation */
        }
        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(10deg); }
        }
        .icon {
            margin: auto;
            text-align: center;
            width: 50px; /* Set width of the image */
            height: auto; /* Maintain aspect ratio */
        }
    </style>
</head>
<body>
    <div id="image-container">
        <img id="dynamic-image" class="icon wiggle" src="" alt="Dynamic Image" style="display: none;"> <!-- Initially hidden -->
    </div>
    <div id="messages"></div>

    <script>
        const messagesDiv = document.getElementById('messages');
        const imageElement = document.getElementById('dynamic-image'); // Image element reference
        const ws = new WebSocket('ws://localhost:8080/');

        ws.onopen = () => {
            console.log('WebSocket connection established');
        };

        ws.onmessage = async (event) => {
            const data = JSON.parse(event.data);

            // Create a message element
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.textContent = `${data.username}: ${data.message}`;

            // Set the new image source and show it
            imageElement.src = 'dwightHead.png'; // Replace with the path to your image
            imageElement.style.display = 'block'; // Show the image

            messagesDiv.appendChild(messageElement); // Append the message below the image
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to the bottom

            // Assume the server sends the estimated duration of TTS in milliseconds
            const ttsDuration = data.duration || 10000; // Default to 10 seconds if not provided

            // Fade out and remove the message after TTS duration
            setTimeout(() => {
                messageElement.classList.add('fade-out'); // Add fade-out class
                // Remove the message after the transition ends
                setTimeout(() => {
                    messagesDiv.removeChild(messageElement);
                    // If no more messages are left, hide the image
                    if (messagesDiv.children.length === 0) {
                        imageElement.style.display = 'none'; // Hide the image after all messages have faded out
                    }
                }, 1000); // Wait for the fade-out transition (1s)
            }, ttsDuration); // Use TTS duration to determine when to start fading out
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
        };

        ws.onclose = () => {
            console.log('WebSocket connection closed');
        };
    </script>
</body>
</html>
